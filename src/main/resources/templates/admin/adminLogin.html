<!DOCTYPE html>
<html xmlns:shiro="http://www.pollix.at/thymeleaf/shiro" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>两个人商城</title>
  <script src="/webjars/jquery/jquery.min.js"></script>
  <script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
  <link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12" style="text-align: center"><h1>管理员登陆</h1></div>
    <!--<div class="row">
      <div shiro:user="" class="col-sm-6" style="text-align: center">
        <h4>看到这个说明你是个有身份的人</h4>
        <div>这是你的信息:<span shiro:principal=""></span></div>
        <div shiro:hasRole="seller"><span>你不仅是个有身份的人,还是个开了个店的人</span></div>
        <div shiro:hasRole="buyer"><span>你不仅是个有身份的人,还是个......的人</span></div>
      </div>
      <div shiro:guest="" class="col-sm-6" style="text-align: center"><h4>看到这个说明你是个游客</h4></div>
      <div id="show" class="col-sm-6" style="text-align: center">
        <a href="toIndex">前往主页</a><br/>
        <a shiro:guest="" href="toRegistration">注册界面</a><br/>
        <a shiro:user="" href="toCart">购物车</a><br/>
        <a shiro:user="" href="toCollect">我的收藏</a><br/>
        <a shiro:user="" href="toUser">个人中心</a><br/>
        <a shiro:hasRole="seller" href="toMyShop">我的店铺</a><br/>
        <a href="toSeller">卖家中心</a><br/>
        <a shiro:user="" href="logout">注销</a>
      </div>
    </div>-->
    <div id="show1" class="col-sm-6 col-sm-offset-3">
      <form class="form-horizontal">
        <div class="form-group">
          <label for="username" class="col-sm-2 control-label">用户名:</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" name="username" id="username" placeholder="username"/>
          </div>
        </div>
        <div class="form-group">
          <label for="password" class="col-sm-2 control-label">密码:</label>
          <div class="col-sm-10">
            <input type="password" class="form-control" name="password" id="password" placeholder="Password"/>
          </div>
        </div>
        <div class="form-group">
          <label for="authCode" class="col-sm-2 control-label">验证码</label>
          <div class="col-sm-5">
            <input type="text" class="form-control" name="authCode" id="authCode" placeholder="authCode" value="yzm"/>
          </div>
          <div class="col-sm-5">
            <img id="getAuthCode" />
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <div class="checkbox">
              <label>
                <input type="checkbox" name="autoLogin" id="autoLogin"/>7日内自动登陆
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button type="button" class="btn btn-default" onclick="login()">登陆</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<span th:text="${requestURL}"></span>
</body>

<script type="text/javascript" th:inline="javascript">
    function login() {
        if(!$("#authCode").hasClass("alert-success")) {
            alert("请输入正确的验证码");
            return null;
        }
        var returnData;
        var username = $("#username").val();
        var password = $("#password").val();
        var authCode = $("#authCode").val();
        var autoLogin = $("#autoLogin")[0].checked;
        username == "" ? alert("用户名不能为空") :
            password == "" ? alert("密码不能为空") :
                authCode == "" ? alert("验证码不能为空") :
                    returnData = 1;
        if (returnData != 1) {
            return null;
        }
        $.ajax({
            url: "/userLogin.do",
            type: "get",
            data: {
                "username": username,
                "password": password,
                "authCode": authCode,
                "autoLogin": autoLogin
            },
            success: function (data) {
                //数字(userId)代表成功 ---f+ 0:用户名或密码错误 1用户名或密码为空 2已经登陆了 3验证码错误
                switch (data) {
                    case "f1" :alert("用户名或密码不能为空");break;
                    case "f0" :alert("用户名或密码错误");break;
                    case "f2" :alert("请不要重复登陆");break;
                    case "f3" :{
                        alert("验证码错误");
                        $("#authCode").val("");
                        $("#getAuthCode").click();
                    }break;
                    default : {
                        [[${requestURL}]] == null ? window.location.href = "toIndex" : window.location.href = [[${requestURL}]];
                    };break;
                }
            },
            error: function (data) {

            }
        })

    }

    <!-- 获取验证码 -->
    $("#getAuthCode").click(function(){
        var url = "authCode.do?t=" + Math.random();
        this.src = url;
    }).click().show();

    $("#authCode").focus(function(){
        var $node = $(this);
        $node.removeClass("alert-success");
        $node.removeClass("alert-danger");
    })
    $("#authCode").blur(function () {
        var $node = $(this);
        var authCode = $node.val();
        $.get("isAuthCode.do?authCode="+authCode,function (data) {
            $node.addClass(data ? "alert-success" : "alert-danger");
        })
    })
</script>
</html>