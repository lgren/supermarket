<!DOCTYPE html>
<html xmlns:shiro="http://www.pollix.at/thymeleaf/shiro" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>两个人商城</title>
  <script src="/webjars/jquery/jquery.min.js"></script>
  <script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
  <link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
  <style type="text/css" rel="stylesheet">
    .col-sm-3 > div {
      border: black 1px solid;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12" style="text-align: center"><h1>这是主页</h1></div>
    <div class="row">
      <div shiro:user="" class="col-sm-6" style="text-align: center">
        <h4>看到这个说明你是个有身份的人</h4>
        <div>这是你的信息:<span shiro:principal=""></span></div>
        <div shiro:hasRole="seller"><span>你不仅是个有身份的人,还是个开了个店的人</span></div>
        <div shiro:hasRole="buyer"><span>你不仅是个有身份的人,还是个......的人</span></div>
      </div>
      <div shiro:guest="" class="col-sm-6" style="text-align: center">
        <h4>看到这个说明你是个游客</h4></div>
      <div id="show" class="col-sm-6" style="text-align: center">
        <a href="toIndex">前往主页</a><br/>
        <a shiro:guest="" href="toRegistration">注册界面</a><br/>
        <a shiro:guest="" href="toLogin">登陆界面</a><br/>
        <a shiro:user="" href="toCart">购物车</a><br/>
        <a shiro:user="" href="toCollect">我的收藏</a><br/>
        <a shiro:user="" href="toUser">个人中心</a><br/>
        <a shiro:hasRole="seller" href="toMyShop">我的店铺</a><br/>
        <a href="toSeller">卖家中心</a><br/>
        <a shiro:user="" href="logout">注销</a>
      </div>
    </div>
    <div id="show1" class="col-sm-3" style="background-color: #bff7ff">
      <div th:each="good : ${goods}">
        <div>
          <a th:href="@{'toGoods/' + ${good.getGoodsId()}}">前往</a><br/>
          <span>商品名:</span><span th:text="${good.getName()}"></span><br/>
          <span>商品类型:</span><span th:text="${good.getDiscount()}"></span><br/>
          <span>图片:</span><span th:text="${good.getImageUrl()}"></span><br/>
          <span>原价:</span><span th:text="${good.getPrice()}"></span><br/>
          <span>折扣价:</span><span th:text="${#numbers.formatDecimal(good.getPrice()*good.getType(),0,2)}"></span>
        </div>
      </div>
    </div>
    <div id="show2" class="col-sm-3" style="background-color: #85c5ff">
      <div th:each="shop : ${shops}">
        <div>
          <a th:href="@{'toShop/' + ${shop.getShopId()}}">前往</a><br/>
          <span>店铺名:</span><span th:text="${shop.getName()}"></span><br/>
          <span>店铺描述:</span><span th:text="${shop.getDescription()}"></span><br/>
        </div>
      </div>
    </div>
    <div id="show3" class="col-sm-3" style="background-color: #59aaff">test3</div>
    <div id="show4" class="col-sm-3" style="background-color: #3176ff">test4</div>
  </div>
  <div class="row">
    <div id="show5" class="col-sm-3" style="background-color: #d5ffbf">test5</div>
    <div id="show6" class="col-sm-3" style="background-color: #bcff84">test6</div>
    <div id="show7" class="col-sm-3" style="background-color: #93ff49">test7</div>
    <div id="show8" class="col-sm-3" style="background-color: #08ff0d">test8</div>
  </div>
  <button style="height: 100px;width: 200px" onclick="doFormRequest('toIndex','get',null)">doFormRequest</button>
  <button style="height: 100px;width: 200px" onclick="submit()">submit</button>
  <button style="height: 100px;width: 200px" onclick="ajax1()">ajax提交</button>
</div>
</body>
</html>
<script>
    /*    function ajax1() {
            var $form = $("#form1");
            var ser$form = $form.serialize();
            var ser$formTest = $form.serializeArray();
            var Json$form = JSON.stringify($form);
            $.ajax({
                url: "test.do",
                type: "post",
                data: $form.serialize(),
                success : function (data) {
                    console.log(data);
                }
            })
        }*/

    function submit() {
        var test = "{'cartGoodsVOList':[{'cartDTO':{'cartGoods':1,'cartId':1,'userId':1},'cartGoodsId':2,'cartGoodsTime':null,'goodsDTO':{'discount':1.0,'goodsId':2,'imageUrl':null,'name':'\u5A03\u54C8\u54C8','price':4.0,'shopId':1,'showTime':null,'type':1},'number':1,'price':3.0},{'cartDTO':{'cartGoods':1,'cartId':1,'userId':1},'cartGoodsId':11,'cartGoodsTime':null,'goodsDTO':{'discount':0.8,'goodsId':1,'imageUrl':'','name':'\u53EF\u4E50','price':3.4,'shopId':1,'showTime':null,'type':1},'number':1,'price':null}],'cartId':1,'userDTO':{'avatarUrl':null,'birthday':'1983-04-22T00:00:00.000+08:00','email':'73625@qq.com','gender':1,'homeaddress':'\u56DB\u5DDD\u6210\u90FD','liveaddress':'\u5E7F\u4E1C\u6DF1\u5733','money':4000.0,'nickname':'\u4E24\u4E2A\u4EBA','password':'user','paymentPassword':'888888','phone':'17263527163','realName':'\u9646\u9E3F\u5B87','userId':1,'username':'user'}}";

        console.log(doFormRequest("test.do", "put", test, null));
    }

    /**
     * 该函数实质为创建一个form表单,然后再提交
     * @param url 例如"localhost:8080/toIndex"
     * @param type 例如"get",支持restful风格
     * @param jsonData json字符串或者对象
     * @param formId form表单Id 该函数实质为创建一个form表单,然后再提交
     * @returns {HTMLFormElement}
     */
    function doFormRequest(url, type, jsonData, formId) {
        var data = (typeof jsonData) == "string" ? eval("(" + jsonData + ")") : jsonData;
        var form = document.createElement("form");
        form.id = formId;
        form.action = url;
        type = type.toLocaleLowerCase();
        if (type == "get") {
            form.method = type;
        } else {
            form.method = "post";
            var input = document.createElement("input");
            input.type = "hidden";
            input.name = "_method";
            input.value = ((type == "delete") ? "delete" : "put");
            form.appendChild(input);
        }
        jsonToInputMini(form, data, null);
        console.log(form);
        document.body.appendChild(form);
        form.submit();
        return form;
    }
    function jsonToInputMini(form, data, varKey) {
        for (var key in data) {
            var lastKey = ((varKey == null) ? key : varKey + "." + key);
            var value = data[key];
            if (Array.isArray(value)) {
                for (var ArrKey in value) jsonToInputMini(form, value[ArrKey], (lastKey + "[" + ArrKey + "]"));
            } else if ((typeof value) == "object") {
                jsonToInputMini(form, value, lastKey);
            } else {
                var input = document.createElement("input");
                input.type = "hidden";
                input.name = lastKey;
                input.value = value;
                form.appendChild(input);
            }
        }
    }
</script>